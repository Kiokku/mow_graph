- > https://github.com/mqyqingfeng/Blog/issues/155
-
- ## 前言
	- 0.1 + 0.2 是否等于 0.3 作为一道经典的面试题，已经广外熟知，说起原因，大家能回答出这是浮点数精度问题导致，也能辩证的看待这并非是 ECMAScript 这门语言的问题，今天就是具体看一下背后的原因。
- ## 数字类型
	- ECMAScript 中的 Number 类型使用 IEEE754 标准来表示整数和浮点数值。所谓 **IEEE754** 标准，全称 IEEE 二进制浮点数算术标准，这个标准定义了表示浮点数的格式等内容。
	- 在 IEEE754 中，规定了四种表示浮点数值的方式：单精确度（32位）、双精确度（64位）、延伸单精确度、与延伸双精确度。像 **ECMAScript 采用的就是双精确度**，也就是说，会用[[#blue]]==64 位来储存一个浮点数==。
- ## 浮点数转二进制
	- ```
	  0.1 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4 + ...
	  
	  0 + 0.2 = a * 2^0 + b * 2^-1 + c * 2^-2 + ...   (a = 0)
	  0 + 0.4 = b * 2^0 + c * 2^-1 + d * 2^-2 + ...   (b = 0)
	  0 + 0.8 = c * 2^0 + d * 2^-1 + e * 2^-2 + ...   (c = 0)
	  1 + 0.6 = d * 2^0 + e * 2^-1 + f * 2^-2 + ...   (d = 1)
	  1 + 0.2 = e * 2^0 + f * 2^-1 + g * 2^-2 + ...   (e = 1)
	  0 + 0.4 = f * 2^0 + g * 2^-1 + h * 2^-2 + ...   (f = 0)
	  0 + 0.8 = g * 2^0 + h * 2^-1 + i * 2^-2 + ...   (g = 0)
	  1 + 0.6 = h * 2^0 + i * 2^-1 + j * 2^-2 + ...   (h = 1)
	  ....
	  ```
	- 然后你就会发现，这个计算在不停的循环，所以 0.1 用二进制表示就是 0.00011001100110011……
- ## 浮点数的存储
	- IEEE754 标准认为，一个浮点数 (Value) 可以这样表示：
	- > Value = sign * exponent * fraction
	- 简单理解就是科学计数法
	- 比如 -1020，用科学计数法表示就是:
	- > -1 * 10^3 * 1.02
	- 对于二进制也是一样，以 0.1 的二进制 0.00011001100110011…… 这个数来说：
	- > 1 * 2^-4 * 1.1001100110011……
	- 而当只做二进制科学计数法的表示时，这个 Value 的表示可以再具体一点变成：
	- > V = (-1)^S * (1 + Fraction) * 2^E
	- 所以，如果要[[#blue]]==存储一个浮点数，我们存 S 和 Fraction 和 E + bias 这三个值==就好了，那具体要分配多少个位来存储这些数呢？IEEE754 给出了标准：
		- 我们会用 1 位存储 S，0 表示正数，1 表示负数。
		- 用 11 位存储 E + bias，对于 11 位来说，bias 的值是 2^(11-1) - 1，也就是 1023。
		- 用 52 位存储 Fraction。
	- 就拿 0.1 来看，对应二进制是 1 * 1.1001100110011…… * 2^-4， Sign 是 0，E + bias 是 -4 + 1023 = 1019，1019 用二进制表示是 1111111011，Fraction 是 1001100110011……
	- 对应 64 位的完整表示就是：
	- > 0 01111111011 1001100110011001100110011001100110011001100110011010
	- 发生了精度丢失，当我们用浮点数进行运算的时候，使用的其实是精度丢失后的数。
- ## 浮点数的运算
	- 关于浮点数的运算，一般由以下五个步骤完成：[[#blue]]==对阶、尾数运算、规格化、舍入处理、溢出判断==。我们来简单看一下 0.1 和 0.2 的计算。
	- `对阶`
		- 先调整为相同的阶码再进行计算，调整原则是小阶对大阶
		- 0.1 是 `1.1001100110011…… * 2^-4`，对应变成 `0.11001100110011…… * 2^-3`
		- 0.2 就是 `1.10011001100110...* 2^-3`
	- `尾数运算`
		- ```
		    0.1100110011001100110011001100110011001100110011001101
		  + 1.1001100110011001100110011001100110011001100110011010
		  ————————————————————————————————————————————————————————
		   10.0110011001100110011001100110011001100110011001100111
		  ```
		-