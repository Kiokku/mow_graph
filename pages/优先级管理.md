- > `React`*内部对于*`优先级`*的管理, 根据功能的不同分为*`LanePriority`*, *`SchedulerPriority`*, *`ReactPriorityLevel`*3 种类型. 在`React@17.0.2`源码中, 一共有`2套优先级体系`和`1套转换体系`
- > `可中断渲染`,`时间切片(time slicing)`,`异步渲染(suspense)`等特性, 在源码中得以实现都依赖于`优先级管理`.
  >
  > 1. `fiber`优先级(`LanePriority`): 位于`react-reconciler`包, 也就是[`Lane(车道模型)`](https://github.com/facebook/react/pull/18796).
  > 2. 调度优先级(`SchedulerPriority`): 位于`scheduler`包.
  > 3. 优先级等级(`ReactPriorityLevel`) : 位于`react-reconciler`包中的[`SchedulerWithReactIntegration.js`](https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/SchedulerWithReactIntegration.old.js), 负责上述 2 套优先级体系的转换.
- ## 预备知识
	- ### Lane (车道模型)
	  background-color:: pink
		- `Lane`模型的源码在[ReactFiberLane.js](https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberLane.js), 源码中大量使用了位运算
		- 首先引入作者对`Lane`的解释([相应的 pr](https://github.com/facebook/react/pull/18796)), 这里简单概括如下:
			- `Lane`类型被定义为二进制变量, 利用了位掩码的特性, 在频繁运算的时候占用内存少, 计算速度快.
			  logseq.order-list-type:: number
			- `Lane`是对于`expirationTime`的重构, 以前使用`expirationTime`表示的字段, 都改为了`lane`
			  logseq.order-list-type:: number
				- ```js
				    renderExpirationtime -> renderLanes
				    update.expirationTime -> update.lane
				    fiber.expirationTime -> fiber.lanes
				    fiber.childExpirationTime -> fiber.childLanes
				    root.firstPendingTime and root.lastPendingTime -> fiber.pendingLanes
				  ```
			- 使用`Lanes`模型相比`expirationTime`模型的优势:
			  logseq.order-list-type:: number
				- `Lanes`把任务优先级从批量任务中分离出来, 可以更方便的判断单个任务与批量任务的优先级是否重叠.
				  logseq.order-list-type:: number
					- ```js
					  // 判断: 单task与batchTask的优先级是否重叠
					  //1. 通过expirationTime判断
					  const isTaskIncludedInBatch = priorityOfTask >= priorityOfBatch;
					  //2. 通过Lanes判断
					  const isTaskIncludedInBatch = (task & batchOfTasks) !== 0;
					  
					  // 当同时处理一组任务, 该组内有多个任务, 且每个任务的优先级不一致
					  // 1. 如果通过expirationTime判断. 需要维护一个范围(在Lane重构之前, 源码中就是这样比较的)
					  const isTaskIncludedInBatch =
					    taskPriority <= highestPriorityInRange &&
					    taskPriority >= lowestPriorityInRange;
					  //2. 通过Lanes判断
					  const isTaskIncludedInBatch = (task & batchOfTasks) !== 0;
					  ```
				- `Lanes`使用单个 32 位二进制变量即可代表多个不同的任务, 也就是说一个变量即可代表一个组(`group`), 如果要在一个 group 中分离出单个 task, 非常容易.
				  logseq.order-list-type:: number
					-
-